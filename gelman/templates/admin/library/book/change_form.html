{% extends "admin/change_form.html" %}

{% block extrahead %}
	<script type="text/javascript" src="/static/scripts/dojo/dojo.js"></script>
	<script type="text/javascript">

var isValidISBN = function(/* String */value) {
    // summary: Vadlidate ISBN-10 or ISBN-13 based on the length of value
	// returns: Boolean
	// not in the trunk right now.

    var len, sum, weight;
    if(typeof value!='string'){
        value = String(value);
    }
    value = value.replace(/[- ]/g,''); //ignore dashes and whitespaces
    len = value.length;
    sum = 0;
    if(len == 10) {
        weight = 10;
        // ISBN-10 validation algorithm
        for(var i = 0; i< 9; i++) {
            sum += parseInt(value.charAt(i)) * weight;
            weight --;
        }
        var t = value.charAt(9).toUpperCase();
        sum += t == 'X' ? 10 : parseInt(t);
        return sum % 11 == 0;
    } else if(len == 13) {
        weight = -1;
        for(var i=0; i< len; i++) {
            sum += parseInt(value.charAt(i)) * (2 + weight);
            weight *= -1;
        }
        return sum % 10 == 0;
    } else {
        return false;
    }
}

	
		dojo.addOnLoad(function() {
			var p = dojo.byId("id_isbn13");
			var n = document.createElement("div")
			p.parentNode.appendChild(n);

			dojo.connect(p, 'onblur', function() {
				if(isValidISBN(p.value)) {
					n.innerHTML = "<div>Searching...</div>"
				} else {
					n.innerHTML = "<div>Invalid ISBN</div>"
				}
			});
			p.removeAttribute("maxlength");
		});
	</script>
		
{% endblock %}
